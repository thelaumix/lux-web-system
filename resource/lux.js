/*!
 * LUX Frontend
 * (c) 2022 thelaumix
 * Released under the MIT License.
*/
const Lux=(d={})=>{let c=Object.assign({backend:"/api",socket:!0},d);var e=[];let a={};a.Call=(b,a=null,d=null)=>(data=null,null!=a&&(data=JSON.stringify(a)),new Promise(f=>{try{$.ajax({contentType:"application/json",data,dataType:"json",complete(a,c){let b={xhr:a,data:c,cancel:!1};for(let d of e)!0!=b.cancel&&d(b);!0!==b.cancel?f({code:a.status,data:a.responseJSON||{}}):f({code:-1,data:{error:"REJECTED_BY_MIDDLEWARE",message:"The request was rejected by a middleware instance"}})},type:d||(null!=a?"POST":"GET"),url:c.backend+"/"+b})}catch{f({code:500,data:{error:"FAILED"}})}})),a.Call.use=a=>{"function"==typeof a&&e.push(a)};let b;if(!0===c.socket){b=io(c.backend,{transports:["websocket"],secure:!0});let f=null;b.on("connect",()=>{"function"==typeof f&&f(!0,b.id)}),b.on("disconnect",()=>{"function"==typeof f&&f(!1)}),a.Socket={Emit:(a,...c)=>new Promise((f,d)=>{try{b.emit(a,...c,a=>{f(a)})}catch(e){d(e)}}),On(a,c){b.on(a,c)},Connection(a){f=a}}}let g=()=>{},h=async()=>{a.Page.Path=window.location.pathname;let b=window.location.pathname.toLowerCase().split("/");b.splice(0,1),a.Page.Args=b,await g()};return a.Page=async(b,e=!1)=>{if($("html").addClass("--loading"),"function"==typeof b)g=b,a.Page.Path=window.location.pathname,await h();else if("string"==typeof b){let c=b;a.Page.Path=c;let f={p_url:c},d="LUX Web System";!0!==e&&history.pushState(f,d,c),document.title=d,await h()}$("html").removeClass("--loading")},a.Page.Args=[],a.Page.Path=window.location.pathname,$("a").live("click",function(c){let b=$(this).attr("href");if("/"==b.substr(0,1))return c.preventDefault(),a.Page(b),!1}),setTimeout(function(){$(window).bind("popstate",function(b){return a.Page(location.pathname,!0),b.preventDefault(!0),!1})},200),a};function QueryMatchUrl(a,b){if("string"!=typeof a||"string"!=typeof b)return!1;"/"==a[0]&&(a=a.substring(1)),"/"==b[0]&&(b=b.substring(1)),"/"==a.substring(a.length-1)&&(a=a.substring(0,a.length-1)),"/"==b.substring(b.length-1)&&(b=b.substring(0,b.length-1));try{if(new RegExp(`^${b}$`).test(a))return!0}catch(j){return!1}let d=a.split("/"),f=b.split("/");if(d.length!=f.length)return!1;let g=0,h={};for(let c=0;c<f.length;c++)try{let e=/:([a-z]+)(\(([^\)]+)\))?/ig.exec(f[c]);if(null!=e){if(null==e[3])h[e[1]]=d[c],g++;else{let i=new RegExp(`^${e[3]}$`).exec(d[c]);null!=i&&(h[e[1]]=i[0],g++)}}else f[c]==d[c]&&g++}catch(k){return!1}return g==d.length&&(h=={}||h)}function WAIT(a){return new Promise(b=>{setTimeout(function(){b()},a)})}Math.clamp=function(b,c,a){return a<b?b:a>c?c:a},Math.lerp=function(a,b,c){return a+(b-a)*c}