/*!
 * LUX Frontend
 * (c) 2022 thelaumix
 * Released under the MIT License.
*/
const Lux=(t={})=>{let e=Object.assign({backend:"/api",socket:!0},t);var n=[];let a={};a.Call=(t,a=null,l=null)=>(data=null,null!=a&&(data=JSON.stringify(a)),new Promise(r=>{try{$.ajax({contentType:"application/json",data,dataType:"json",xhrFields:{withCredentials:!0},complete(t,e){let a={xhr:t,data:e,cancel:!1};for(let l of n)!0!=a.cancel&&l(a);!0!==a.cancel?r({code:t.status,data:t.responseJSON||{}}):r({code:-1,data:{error:"REJECTED_BY_MIDDLEWARE",message:"The request was rejected by a middleware instance"}})},type:l||(null!=a?"POST":"GET"),url:e.backend+"/"+t})}catch{r({code:500,data:{error:"FAILED"}})}})),a.Call.use=t=>{"function"==typeof t&&n.push(t)};let l;if(!0===e.socket){let r,c={},o=()=>{(l=io(e.backend,{transports:["websocket"],secure:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:1/0})).on("connect",()=>{for(let t in"function"==typeof r&&r(!0,l.id),c)l.on(t,c[t])}),l.on("disconnect",()=>{"function"==typeof r&&r(!1)})};o(),a.Socket={Emit:(t,...e)=>new Promise((n,a)=>{try{l.emit(t,...e,t=>{n(t)})}catch(r){a(r)}}),On(t,e){c[t]=e;try{l.on(t,e)}catch(n){}},Connection(t){r=t},Reconnect(){l.disconnect(),o()}}}let i=()=>{},s=async()=>{a.Page.Path=window.location.pathname;let t=window.location.pathname.toLowerCase().split("/");t.splice(0,1),a.Page.Args=t,await i()};return a.Page=async(t,e=!1)=>{if($("html").addClass("--loading"),"function"==typeof t)i=t,a.Page.Path=window.location.pathname,await s();else if("string"==typeof t){let n=t;a.Page.Path=n;let l={p_url:n},r="LUX Web System";!0!==e&&history.pushState(l,r,n),document.title=r,await s()}$("html").removeClass("--loading")},a.Page.Args=[],a.Page.Path=window.location.pathname,$("a").live("click",function(t){let e=$(this).attr("href");if("/"==e.substr(0,1))return t.preventDefault(),a.Page(e),!1}),setTimeout(function(){$(window).bind("popstate",function(t){return a.Page(location.pathname,!0),t.preventDefault(!0),!1})},200),a};function QueryMatchUrl(t,e){if("string"!=typeof t||"string"!=typeof e)return!1;"/"==t[0]&&(t=t.substring(1)),"/"==e[0]&&(e=e.substring(1)),"/"==t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),"/"==e.substring(e.length-1)&&(e=e.substring(0,e.length-1));try{if(RegExp(`^${e}$`).test(t))return!0}catch(n){return!1}let a=t.split("/"),l=e.split("/");if(a.length!=l.length)return!1;let r=0,c={};for(let o=0;o<l.length;o++)try{let i=/:([a-z]+)(\(([^\)]+)\))?/ig.exec(l[o]);if(null!=i){if(null==i[3])c[i[1]]=a[o],r++;else{let s=RegExp(`^${i[3]}$`).exec(a[o]);null!=s&&(c[i[1]]=s[0],r++)}}else l[o]==a[o]&&r++}catch(u){return!1}return r==a.length&&(c=={}||c)}function WAIT(t){return new Promise(e=>{setTimeout(function(){e()},t)})}Math.clamp=function(t,e,n){return n<t?t:n>e?e:n},Math.lerp=function(t,e,n){return t+(e-t)*n};